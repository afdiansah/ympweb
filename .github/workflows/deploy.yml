name: Deploy to CPanel

on:
  push:
    branches:
      - main

jobs:
  ftp-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Parse FTP Config
      id: parse
      run: |
        echo "::set-output name=ftp_config::$(echo '${{ secrets.YMP_WEB_FTP }}' | jq -r '.server, .username, .password, .port')"
    
    - name: FTP Upload
      uses: SamKirkland/FTP-Deploy-Action@4.1.0
      with:
        server: ${{ steps.parse.outputs.ftp_config[0] }}
        username: ${{ steps.parse.outputs.ftp_config[1] }}
        password: ${{ steps.parse.outputs.ftp_config[2] }}
        local-dir: ./
        server-dir: /public_html
        port: ${{ steps.parse.outputs.ftp_config[3] }}
